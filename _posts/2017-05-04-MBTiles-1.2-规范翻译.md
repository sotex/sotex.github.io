---
layout:  post
title:  "MBTiles 1.2 规范翻译"
date:  2017-05-04
categories:  其它
tags:  其它
comments: 1
---

[TOC]
[博客园文章地址 http://www.cnblogs.com/oloroso/archive/2017/05/04/6806323.html](http://www.cnblogs.com/oloroso/archive/2017/05/04/6806323.html)
# MBTiles 1.2

可以参考超图的文档[MBTiles扩展](http://support.supermap.com.cn/DataWarehouse/WebDocHelp/6.1.3/iserverOnlineHelp/Subject_introduce/MapCache/2D_cache/MBTiles_expand.htm)
具体实现可以参考[浅谈利用SQLite存储离散瓦片的思路和实现方法](http://www.cnblogs.com/naaoveGIS/p/5461448.html)

mapbox提供了一个简单实现测试代码，github地址在这里[https://github.com/mapbox/mbtiler.git](https://github.com/mapbox/mbtiler.git)

# 子标签:

* **Interaction**: 实现交互所需的HTTP端点
* **UTFGrid**:此规范依赖于[UTFGrid 1.2](https://github.com/mapbox/utfgrid-spec)进行交互.

## 抽象

MBTiles是在[SQLite](http://sqlite.org/)数据库中存储地图瓦片数据的规范，用于即时使用和传送.
MBTiles文件称为**tilesets**(瓦片集)，必须实现以下规范，以确保与设备的兼容性。

## 数据库规格

Tilesets使用[version 3.0.0](http://sqlite.org/formatchng.html)或更高版本的SQLite数据库。
仅使用SQLite核心功能; tilesets **无需扩展**.

MBTiles数据库可以选用[官方分配幻数(magic number)](http://www.sqlite.org/src/artifact?ci=trunk&filename=magic.txt)去快速识别为MBTiles。

## 数据库

注意: 所概述的`schemas`尽量遵循接口。产生兼容结果的SQLite视图同样有效。
方便起见，本规范将`表`(tables)和`虚拟表`(virtual tables，视图views)都当做表(tables)。

### Metadata 元数据

#### Schema 方案

数据库需要包含名为`metadata`的table或view。

该表必须具有名为`name`和`value`的两列。`metadata`表典型创建语句如下:
```sql
    CREATE TABLE metadata (name text, value text);
```

#### Content 内容

`metadata`表用作`key/value`存储，用于保存一些配置`settings`。

以下五个key是**必须**的:

* `name`: tileset的纯英文名称.
* `type`: `overlay`(覆盖型)或`baselayer`(基本图层型).
* `version`: tileset的版本,纯数字.
* `description`: 描述图层(layer)的文本.
* `format`: 瓦片数据的图像文件格式: `png`或`jpg`

`row`在`metadata`中是**推荐**提供的,如有，可以提高性能。

* `bounds`: 呈现的地图区域的最大范围。`Bounds`必须定义所有缩放级别所覆盖的区域。范围`bounds`以`WGS:84`中经纬度值表示，在`OpenLayers Bounds`格式表示为-
  **左,下,右,上**.全球范围为例: `-180.0,-85,180,85`.
  
* `attribution`:属性字符串，使用纯英文(和HTML)解释地图数据和(或)样式的来源.

通常的tilesets实现都支持这些附加键。
[基于UTFGrid交互](https://github.com/mapbox/utfgrid-spec).

### Tiles 瓦片

#### Schema 方案

数据库需要包含名为`tiles`的表.

该表必须具有`zoom_level`、`tile_column`、`tile_row`和`tile_data`四列。`tiles`表典型创建语句如下:
```sql
    CREATE TABLE tiles (zoom_level integer, tile_column integer, tile_row integer, tile_data blob);
```

#### Content 内容

`tiles`用于包含瓦片和用于定位的值。
`zoom_level`、`tile_column`和`tile_row`列在其构造中遵循
[Tile Map Service规范](http://wiki.osgeo.org/wiki/Tile_Map_Service_Specification)，但受限于以下形式:

**假定是[global-mercator](http://wiki.osgeo.org/wiki/Tile_Map_Service_Specification#global-mercator) (球面墨卡托SphericalMercator)**

`tile_data blob`列包含原始图像二进制数据.

图像文件的格式允许使用以下两种:
* `png`
* `jpg`

### Grids 网格

有关网格和交互元数据本身的实现细节，请参阅[UTFGrid规范](https://github.com/mapbox/utfgrid-spec)：MBTiles规范仅涉及存储。

#### Schema 方案

数据库可以有可选的表`grids`和`grid_data`。

`grids`必须具有`zoom_level`、`tile_column`、`tile_row`和`grid`四列。`grids`表典型创建语句如下:
```sql
    CREATE TABLE grids (zoom_level integer, tile_column integer, tile_row integer, grid blob);
```

`grid_data`必须具有`zoom_level`、`tile_column`、`tile_row`、`key_name`和`key_json`五列。`grid_data`表典型创建语句如下:
```sql
    CREATE TABLE grid_data (zoom_level integer, tile_column integer, tile_row integer, key_name text, key_json text);
```

#### Content 内容

`grids`表包含`UTFGrid`数据，gzip压缩。
`grid_data`表包含`grid key`到`value`映射，将`value`编码为JSON对象。