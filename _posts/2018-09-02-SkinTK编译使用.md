---
layout:  post
title:  "SkinTK编译使用"
date:  2018-09-02
categories:  编程
tags:  编程
comments: 1
---

[TOC]
[博客园文章地址 http://www.cnblogs.com/oloroso/archive/2018/09/02/9574491.html](http://www.cnblogs.com/oloroso/archive/2018/09/02/9574491.html)
# 简介

MFC这个东西已经落伍了，不建议使用。我就是吃饱了撑着，还在折腾这个。
平时写点带界面的小程序一般都用Qt来做，简单好用，也很容易做的比较漂亮。我觉得唯一一个算不得多大缺点的缺点就是Qt体积太大了。
之前用MFC写过几个小程序，那天看见一个介绍MFC美化的文章，就想着也给来加个皮肤。只是MFC没有像Qt的`qss`这么方便的东西。
网上看到一个开源的库`SkinTK`，就[下载](http://www.pudn.com/Download/item/id/1114327.html)回来试试。
这个库不知道与`CJ60Lib`有什么关系，在这里下载的源码里面有一部分是来自cj60的。附上CJ60LIB的一篇编译说明[http://www.cnblogs.com/icmzn/p/6724969.html](http://www.cnblogs.com/icmzn/p/6724969.html)

修改后的代码上传到了gitee，下载地址[https://gitee.com/solym/SkinTK_VS2017](https://gitee.com/solym/SkinTK_VS2017)

# 编译
编译过程倒是不难，就是有些地方需要改动一下，比较烦。
这个库依赖于`Detours`，来Hook与Windows窗口操作相关的一些系统函数。
Detours这个库已经微软已经开源了，下载地址[https://github.com/Microsoft/Detours.git](https://github.com/Microsoft/Detours.git)
因为它原本使用的是老版本的，不支持64位系统，所以我给替换成了最新的。

编译的时候要修改一些地方。

- 1、针对64位的修改
    很多用到了`SetWindowLong`和`GetWindowLong`以及`GetClassLong`的地方需要修改为`SetWindowLongPtr`和`GetWindowLongPtr`和`GetClassLongPtr`。

- 2、`CMemDC`的修改
    因为VC2010版本已经包含了`CMemDC`的实现，而这个库自己实现了一个，在使用的时候会有冲突，所以进行以下修改
```cpp
// 文件 include\MenDC.h
// 类 CMemDC声明前加上
#if _MSC_VER >= 1600
#define CMemDC SkinCMemDC
#endif
```
    否则可能出现 uafxcwd.lib(afxglobals.obj) error LNK2005: "public: virtual __thiscall CMemDC::~CMemDC(void)" (??1CMemDC@@UAE@XZ) already defined in

- 3、修改SKINTKDLL宏定义
    因为我要编译静态库版本，所以这里SKINTKDLL宏的定义修改为空

- 4、问题
    这里还有很多问题，我没有去解决。64位编译的结果回出现崩溃的状况，具体来说是在`SetWindowLongPtr`函数调用的时候出现`0x5c00000000`异常的问题。
   32位也有问题，不加载皮肤没有问题，加载皮肤运行一会就崩溃。

# 使用

具体的使用方法见[使用SkinTK进行换肤](http://blog.51cto.com/qsjming/554100)
下面是使用前后的一个对比图

![](https://images2018.cnblogs.com/blog/693958/201809/693958-20180902171207185-914015043.jpg)
![](https://images2018.cnblogs.com/blog/693958/201809/693958-20180902171218190-70086593.jpg)