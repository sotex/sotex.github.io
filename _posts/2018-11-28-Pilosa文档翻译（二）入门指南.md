---
layout:  post
title:  "Pilosa文档翻译（二）入门指南"
date:  2018-11-28
categories:  其它
tags:  其它
comments: 1
---
[TOC]
[博客园原文地址 http://www.cnblogs.com/oloroso/archive/2018/11/28/10027502.html](http://www.cnblogs.com/oloroso/archive/2018/11/28/10027502.html)



Pilosa支持默认使用`JSON`的`HTTP`接口。
任何HTTP工具都可用于与`Pilosa`服务器进行交互。 本文档中的示例将使用`curl`，默认情况下可用于许多类UNIX系统，包括Linux和MacOS。 Windows用户可以在这里下载[curl](https://curl.haxx.se/download.html)。

> 请注意，Pilosa服务器对打开文件的上限有要求。 检查系统文档，了解如何在达到该限制时增加它。 有关详细信息，请参阅[ Open File Limits](https://www.pilosa.com/docs/administration/#open-file-limits)。

# 开始 Pilosa
按照安装文档中的步骤安装Pilosa。 在终端中执行以下命令，以使用默认配置运行Pilosa（Pilosa将在localhost：10101中可用）：
```bash
pilosa server
```
如果您使用的是Docker镜像，则可以使用以下命令在默认地址上运行短暂的Pilosa容器：
```bash
docker run -it --rm --name pilosa -p 10101:10101 pilosa/pilosa:latest
```
确保Pilosa正在运行：
```bash
curl localhost:10101/status
```
```json
{"state":"NORMAL","nodes":[{"id":"91715a50-7d50-4c54-9a03-873801da1cd1","uri":{"scheme":"http","host":"localhost","port
":10101},"isCoordinator":true}],"localID":"91715a50-7d50-4c54-9a03-873801da1cd1"}
```

# 简单项目

为了更好地理解`Pilosa`的功能，我们将创建一个名为`Star Trace`的示例项目，其中包含有`1000`个流行的Github存储库的信息，这些存储库名称中包含`go`。`Star Trace`索引将包括数据点，例如编程语言，标签和star者(已经为项目加星标的人)。

尽管`Pilosa`没有以表格形式保存数据，但在描述数据模型时我们仍然使用术语`列`和`行`。我们将**主对象放在列中**，并将这些**对象的属性放在行中**。
例如，`Star Trace`项目将包含一个名为`repository`的索引，其中包含表示Github存储库的`列`，以及表示`编程语言`和`标签`等属性的行。我们可以通过将行分组为名为`Fields`的集合来更好地组织行。因此，`repository`(存储库)索引可能具有`languages`(语言)字段以及`tags`(标签)字段。您可以在文档的[Data Model](https://www.pilosa.com/docs/latest/data-model/)(数据模型)部分中了解有关索引和字段的更多信息。

# 创建架构(Create the Schema)

**注意：如果您想在任何时候验证数据结构，可以按如下方式请求架构：**
```bash
curl localhost:10101/schema
```
```json
{"indexes":null}
```
在我们在导入数据或运行查询之前，需要创建索引及其中的字段。 下面先创建存储库索引：
下面命令成功的创建一个名为`repository`的索引
```bash
curl localhost:10101/index/repository -X POST
```
```json
{"success":true}
```
接下来创建一个`stargazer`字段，该字段的行内容(数据)为star者的用户ID
```bash
curl localhost:10101/index/repository/field/stargazer \
     -X POST \
     -d '{"options": {"type": "time", "timeQuantum": "YMD"}}'
```
```json
{"success":true}
```
由于我们的数据包含时间戳，这些时间戳代表用户`start`的时间，因此我们将字段类型设置为`time`。`timeQuantum`(时间量)是我们想要使用的时间分辨率，我们将其设置为`star`的`YMD`（年月日）。

接下来创建`language`字段，其行(数据)中包含编程语言的ID
```bash
curl localhost:10101/index/repository/field/language \
     -X POST
```
```json
{"success":true}
```
`language`是一个`set`(集合)字段，但由于默认字段类型是`set`，因此我们未在字段选项中指定它。

# 从CVS文件导入数据
下载`stargazer.cvs`和`language.cvs`文件
```bash
curl -O https://raw.githubusercontent.com/pilosa/getting-started/master/stargazer.csv
curl -O https://raw.githubusercontent.com/pilosa/getting-started/master/language.csv
```
运行下面的命令将数据导入到Pilosa
```bash
pilosa import -i repository -f stargazer stargazer.csv
pilosa import -i repository -f language language.csv
```
如果您正在使用`Pilosa`的`Docker`容器（名为`pilosa`），则应将`* .csv`文件复制到容器中，然后导入它们
```bash
docker cp stargazer.csv pilosa:/stargazer.csv
docker exec -it pilosa /pilosa import -i repository -f stargazer /stargazer.csv
docker cp language.csv pilosa:/language.csv
docker exec -it pilosa /pilosa import -i repository -f language /language.csv
```
**请注意，用户ID(user IDs)和存储库ID(repository IDs)都重新映射到顺序整数存在数据文件中，它们不再与实际的`Github ID`相对应。 您可以查看[languages.txt](https://github.com/pilosa/getting-started/blob/master/languages.txt)以查看语言的映射。**

# 做一些查询(Queries)
- 用户14(用户ID的映射整数值)`star`了那些`repository`(存储库)
```bash
curl localhost:10101/index/repository/query \
     -X POST \
     -d 'Row(stargazer=14)'
```
```json
{
    "results":[
        {
            "attrs":{},
            "columns":[1,2,3,362,368,391,396,409,416,430,436,450,454,460,461,464,466,469,470,483,484,486,490,491,503,504,514]
        }
    ]
}
```
- 样本数据中的前5种编程语言是什么
```bash
curl localhost:10101/index/repository/query \
     -X POST \
     -d 'TopN(language, n=5)'
```
```json
{
    "results":[
        [
            {"id":5,"count":119},
            {"id":1,"count":50},
            {"id":4,"count":48},
            {"id":9,"count":31},
            {"id":13,"count":25}
        ]
    ]
}
```
- 用户**14且19**`star`了哪些`repository`(存储库)
```bash
curl localhost:10101/index/repository/query \
     -X POST \
     -d 'Intersect(
            Row(stargazer=14), 
            Row(stargazer=19)
        )'
```
```json
{
    "results":[
        {
            "attrs":{},
            "columns":[2,3,362,396,416,461,464,466,470,486]
        }
    ]
}
```
- 用户**14或19**`star`了哪些`repository`(存储库)
```bash
curl localhost:10101/index/repository/query \
     -X POST \
     -d 'Union(
            Row(stargazer=14), 
            Row(stargazer=19)
        )'
```
```json
{
    "results":[
        {
            "attrs":{},
            "columns":[1,2,3,361,362,368,376,377,378,382,386,388,391,396,398,400,409,411,412,416,426,428,430,435,436,450,452,453,454,456,460,461,464,465,466,469,470,483,484,486,487,489,490,491,500,503,504,505,512,514]
        }
    ]
}
```
- 哪些存储库由用户**14且19**加星标，**并且**还用语言1编写：
```bash
curl localhost:10101/index/repository/query \
     -X POST \
     -d 'Intersect(
            Row(stargazer=14), 
            Row(stargazer=19),
            Row(language=1)
        )'
```
```json
{
    "results":[
        {
            "attrs":{},
            "columns":[2,362,416,461]
        }
    ]
}
```

- 将用户`99999`设置为存储库`77777`的`star`者
```bash
curl localhost:10101/index/repository/query \
     -X POST \
     -d 'Set(77777, stargazer=99999)'
```
```json
{"results":[true]}
```
请注意，虽然**用户ID**`99999`可能**此列**其它`ID不连续`，但它仍然是一个相对较小的数字。 不要尝试在Pilosa中使用`任意64位整数`作为列ID或行ID，**这将导致诸如性能不佳和内存不足错误等问题。**

# 接下来做什么?
您可以跳转到[Data Model数据模型](https://www.pilosa.com/docs/latest/data-model/)以深入了解`Pilosa`的`数据模型`，或查询有关`PQL`（Pilosa的查询语言[Query Language](https://www.pilosa.com/docs/latest/query-language/)）的更多详细信息。
查看[Examples示例](https://www.pilosa.com/docs/latest/examples/)页面，了解Pilosa的实际使用样例。看我们不断扩展的客户端库[Client Libraries](https://www.pilosa.com/docs/latest/client-libraries/)有没有你喜欢的编程语言版本。