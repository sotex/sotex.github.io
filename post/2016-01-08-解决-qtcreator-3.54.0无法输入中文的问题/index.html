  <!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <title> 解决 QtCreator 3.5(4.0)无法输入中文的问题 &middot; 风吹过 </title>
    
    <link rel="stylesheet" type="text/css" href="http://sotex.github.io//css/uno.min.css" />
    <link rel="stylesheet" type="text/css" href="http://sotex.github.io//css/lightGallery.css" />
    
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.ico">
    
    <link href="" rel="alternate" type="application/rss+xml" title="风吹过" />
    
    <script src="http://sotex.github.io//js/jquery.min.js"></script>
    <script src="http://sotex.github.io//js/main.min.js">
    </script>
</head>

  <body>
    <div id="scriptHeader">
    <span class="mobile btn-mobile-menu">
            <i class="fa fa-bars btn-mobile-menu__icon"></i>
            <i class="fa fa-times btn-mobile-close__icon hidden"> </i>
    </span>
    <header class="
        
            panel-cover panel-cover--collapsed
        " >
    <div class="panel-main">
        <div class="panel-main__inner panel-inverted">
            <div class="panel-main__content"> 
                <a href="http://sotex.github.io//" title="link to homepage for 风吹过"> <img src="/images/user.png" width="80" alt="风吹过 logo" class="panel-cover__logo logo" /> </a> 
                <h1 class="panel-cover__title panel-title">
                    <a href="http://sotex.github.io//"  title="link to homepage for 风吹过">风吹过</a>
                </h1>
                <hr class="panel-cover__divider" />
                <p class="panel-cover__description">  以前，晚餐后在学校田径场的大榕树下，散散步吹吹风，累了就去图书馆看看书，感觉真好。  </p>
                <hr class="panel-cover__divider panel-cover__divider--secondary" />
                <div class="navigation-wrapper">
                    <nav class="cover-navigation cover-navigation--primary">
                        <ul class="navigation">
                            <li class="navigation__item"><a href="http://sotex.github.io/#blog" title="查看 风吹过 博客" class="blog-button">博客</a> </li></br>
                            <li class="navigation__item"><a href="/pages/about.html" title="查看简介 " class="blog-button">简介</a> </li></br> 
                            
                       </ul>
                    </nav> <nav class="cover-navigation navigation--social">
    <ul class="navigation"> 
	
        
        <li class="navigation__item">
            <a href="http://cnblogs.com/oloroso" title="@oloroso 博客园"> <i class='fa fa-twitter'></i> <span class="label">cnblogs</span> </a>
        </li> 
	
	
        
        <li class="navigation__item">
            <a href="https://github.com/sotex" title="sotex on github"> <i class='fa fa-github'></i> <span class="label">Github</span> </a>
        </li>  </br>
	
	
	
        
        <li class="navigation__item">
            <a href="mailto:ymwh@foxmail.com" title="Email ymwh@foxmail.com"> <i class='fa fa-envelope-o'></i> <span class="label">Email</span> </a>
        </li>  </ul>
</nav>
 </div>
            </div>
        </div>
        <div class="panel-cover--overlay"></div>
    </div>
</header>
</div>
<noscript>
    <style>
        #scriptHeader {display:none;}
        .navigation-wrapper{
            display: block;
            top: 0;
        }
    </style>

    <header class="panel-cover panel-cover--collapsed" style="background-image: url()">
        <div class="panel-main">
            <div class="panel-main__inner panel-inverted">
                <div class="panel-main__content"> 
                    <a href="http://sotex.github.io//" title="link to homepage for 风吹过"> <img src="/images/user.png" width="80" alt="风吹过 logo" class="panel-cover__logo logo" /> </a> 
                    <h1 class="panel-cover__title panel-title">
                        <a href="http://sotex.github.io//"  title="link to homepage for 风吹过">风吹过</a>
                    </h1>
                    <hr class="panel-cover__divider" />
                    <p class="panel-cover__description">  以前，晚餐后在学校田径场的大榕树下，散散步吹吹风，累了就去图书馆看看书，感觉真好。  </p>
                    <hr class="panel-cover__divider panel-cover__divider--secondary" />
                    <div class="navigation-wrapper">
                        <nav class="cover-navigation cover-navigation--primary">
                            <ul class="navigation">
                                <li class="navigation__item"><a href="http://sotex.github.io//#blog" title="查看 风吹过 博客" class="blog-button">博客</a> </li></br>
                                <li class="navigation__item"><a href="/pages/about.html" title="查看简介" class="blog-button">简介</a> </li></br> 
                                
                           </ul>
                        </nav> <nav class="cover-navigation navigation--social">
    <ul class="navigation"> 
	
        
        <li class="navigation__item">
            <a href="http://cnblogs.com/oloroso" title="@oloroso 博客园"> <i class='fa fa-twitter'></i> <span class="label">cnblogs</span> </a>
        </li> 
	
	
        
        <li class="navigation__item">
            <a href="https://github.com/sotex" title="sotex on github"> <i class='fa fa-github'></i> <span class="label">Github</span> </a>
        </li>  </br>
	
	
	
        
        <li class="navigation__item">
            <a href="mailto:ymwh@foxmail.com" title="Email ymwh@foxmail.com"> <i class='fa fa-envelope-o'></i> <span class="label">Email</span> </a>
        </li>  </ul>
</nav>
 </div>
                </div>
            </div>
            <div class="panel-cover--overlay"></div>
        </div>
    </header>
</noscript>

    <div class="content-wrapper">
      <div class="content-wrapper__inner">
        <div class="post">
          <h1>解决 QtCreator 3.5(4.0)无法输入中文的问题</h1>
          <span class="post-date">2016年01月08日</span>
          <p>#解决 QtCreator 3.5.1无法输入中文的问题
[TOC]
<a href="http://www.cnblogs.com/oloroso/archive/2016/01/08/5114041.html">博客园原文地址 http://www.cnblogs.com/oloroso/archive/2016/01/08/5114041.html</a></p>

<p>环境是ubuntu 15.10
ubuntu软件源中下载安装的<code>fctix-libs-qt5</code>现在没有用，版本太旧了。
自己下载<code>fctix-qt5</code>的源码来编译即可。</p>

<p>##1、获取fctix-qt5源码
我没有找到<code>fcitx-qt5</code>的<code>git</code>仓库地址，只找到了源码包的下载地址。</p>

<p>先下载源码包，并解压。</p>

<pre><code class="language-shell">wget https://download.fcitx-im.org/fcitx-qt5/fcitx-qt5-1.0.5.tar.xz
tar -xJf fcitx-qt5-1.0.5.tar.xz
</code></pre>

<p>找到了git仓库地址</p>

<pre><code class="language-shell">git clone http://github.com/fcitx/fcitx-qt5.git
</code></pre>

<p>##2、生成Makefile文件
这一步很简单，进入源码目录，然后新建一个build的目录并进入，然后使用<code>cmake</code>来生成Makefile</p>

<pre><code class="language-shell">cd fcitx-qt5
mkdir build &amp;&amp; cd build
cmake ..
</code></pre>

<p>这一个步骤产生了几个错误，这和系统环境有关。如果你的没有产生错误，后面就不用看了
###2.1、没有找到&rdquo;ECM&rdquo;包配置文件报错
<strong>错误信息</strong></p>

<pre><code class="language-shell">cmake ..
-- The C compiler identification is GNU 5.2.1
-- The CXX compiler identification is Clang 3.7.0
... ...
-- Detecting CXX compile features - done
CMake Error at CMakeLists.txt:8 (find_package):
  Could not find a package configuration file provided by &quot;ECM&quot; (requested
  version 1.4.0) with any of the following names:

    ECMConfig.cmake
    ecm-config.cmake

  Add the installation prefix of &quot;ECM&quot; to CMAKE_PREFIX_PATH or set &quot;ECM_DIR&quot;
  to a directory containing one of the above files.  If &quot;ECM&quot; provides a
  separate development package or SDK, be sure it has been installed.


-- Configuring incomplete, errors occurred!
See also &quot;/home/o/fcitx/fcitx-qt5/CMakeFiles/CMakeOutput.log&quot;.
</code></pre>

<p><strong>解决办法</strong>
先下载cmake的扩展模块包</p>

<pre><code class="language-shell">wget https://launchpadlibrarian.net/189487929/extra-cmake-modules_1.4.0.orig.tar.xz
tar -xJf extra-cmake-modules_1.4.0.orig.tar.xz
</code></pre>

<p>进入其中，然后执行<code>cmake .</code>来生成<code>Makefile</code>文件
这一步需要指定两个变量</p>

<pre><code>//The directory containing a CMake configuration file for Qt5Core.
Qt5Core_DIR:PATH=/home/o/program/qt_5.5/qt_5.5.1_x64/5.5/gcc_64/lib/cmake/Qt5Core

//The directory containing a CMake configuration file for Qt5LinguistTools.
Qt5LinguistTools_DIR:PATH=/home/o/program/qt_5.5/qt_5.5.1_x64/5.5/gcc_64/lib/cmake/Qt5LinguistTools
</code></pre>

<p><strong>2016年08月17日更新</strong>
上面一步其实直接指定<code>Qt_DIR</code>目录也就可以了。</p>

<pre><code class="language-shell">#只需要指定Qt5_DIR路径即可
cmake -DQt5_DIR=/home/o/pragram/qt_5.7/5.7/gcc_64/lib/cmake/Qt5 .
</code></pre>

<p>生成了<code>Makefile</code>之后，直接<code>sudo make install</code>来安装就可以了。</p>

<p>###2.2、找不到<code>Qt5</code>包配置文件的错误
<strong>报错信息</strong></p>

<pre><code class="language-shell">CMake Error at CMakeLists.txt:29 (find_package):
  Could not find a package configuration file provided by &quot;Qt5&quot; (requested
  version 5.1.0) with any of the following names:

    Qt5Config.cmake
    qt5-config.cmake

  Add the installation prefix of &quot;Qt5&quot; to CMAKE_PREFIX_PATH or set &quot;Qt5_DIR&quot;
  to a directory containing one of the above files.  If &quot;Qt5&quot; provides a
  separate development package or SDK, be sure it has been installed.


-- Configuring incomplete, errors occurred!
See also &quot;/home/o/fcitx/fcitx-qt5/build/CMakeFiles/CMakeOutput.log&quot;.
</code></pre>

<p>这个错误很好解决，设置变量<code>Qt5_DIR</code>即可</p>

<pre><code class="language-shell">cmake -DQt5_DIR=/home/o/program/qt_5.5/qt_5.5.1_x64/5.5/gcc_64/lib/cmake/Qt5 ..
</code></pre>

<p>###2.3、libxkbcommon问题
<strong>错误信息</strong></p>

<pre><code class="language-shell">o@o-pc:~/fcitx/fcitx-qt5/build$ cmake -DQt5_DIR=/home/o/program/qt_5.5/qt_5.5.1_x64/5.5/gcc_64/lib/cmake/Qt5  ..
-- Found PkgConfig: /usr/bin/pkg-config (found version &quot;0.28&quot;) 
-- Found XKBCommon_XKBCommon: /usr/lib/x86_64-linux-gnu/libxkbcommon.so (found version &quot;0.5.0&quot;) 
-- Found XKBCommon: /usr/lib/x86_64-linux-gnu/libxkbcommon.so (found suitable version &quot;0.5.0&quot;, minimum required is &quot;0.5.0&quot;) found components:  XKBCommon 
-- checking for module 'fcitx-utils'
--   package 'fcitx-utils' not found
CMake Error at /usr/share/cmake-3.2/Modules/FindPkgConfig.cmake:344 (message):
  A required package was not found
Call Stack (most recent call first):
  /usr/share/cmake-3.2/Modules/FindPkgConfig.cmake:506 (_pkg_check_modules_internal)
  CMakeLists.txt:32 (pkg_check_modules)


-- Configuring incomplete, errors occurred!
See also &quot;/home/o/fcitx/fcitx-qt5/build/CMakeFiles/CMakeOutput.log&quot;.
</code></pre>

<p><strong>这个问题的解决如下</strong>
先下载<code>libxkbcommon-0.5.0.tar.xz</code>，然后解压编译</p>

<pre><code class="language-shell">http://xkbcommon.org/download/libxkbcommon-0.5.0.tar.xz
tar -xJf libxkbcommon-0.5.0.tar.xz
</code></pre>

<p>这个使用<code>./configure --disable-x11</code>来生成Makefile。禁用<code>x11</code>是因为我机器上的<code>x11</code>版本过高的原因。</p>

<p>编译的时候可能会报错</p>

<pre><code class="language-shell"> make
  YACC     src/xkbcomp/parser.c
./build-aux/ylwrap: 行 176: yacc: 未找到命令
Makefile:1522: recipe for target 'src/xkbcomp/parser.c' failed
make: *** [src/xkbcomp/parser.c] Error 127
</code></pre>

<p>需要<code>yacc</code>的支持。这个工具包含在软件包<code>bison</code>中。</p>

<pre><code class="language-shell">o@o-pc:~/fcitx/libxkbcommon-0.5.0$ sudo apt-get install bison
</code></pre>

<p>然后直接<code>make &amp;&amp; make install</code>安装就是。</p>

<p>###2.4、&rsquo;fcitx-utils&rsquo; not found错误
这个错误是因为我们没有安装<code>fcitx-libs-dev</code>的缘故，所以解决的办法就是安装它就是。
<strong>错误信息</strong></p>

<pre><code class="language-shell">o@o-pc:~/fcitx/fcitx-qt5/build$ cmake -DQt5_DIR=/home/o/program/qt_5.5/qt_5.5.1_x64/5.5/gcc_64/lib/cmake/Qt5  ..
-- checking for module 'fcitx-utils'
--   package 'fcitx-utils' not found
CMake Error at /usr/share/cmake-3.2/Modules/FindPkgConfig.cmake:344 (message):
  A required package was not found
Call Stack (most recent call first):
  /usr/share/cmake-3.2/Modules/FindPkgConfig.cmake:506 (_pkg_check_modules_internal)
  CMakeLists.txt:32 (pkg_check_modules)

-- Configuring incomplete, errors occurred!
</code></pre>

<p><strong>解决办法</strong></p>

<pre><code class="language-shell">sudo apt-get install fcitx-libs-dev 
</code></pre>

<p>##3、编译出动态库
经过上面的步骤，生成了<code>Makefile</code>文件后，接下来的步骤就很简单了，直接<code>make</code>来编译即可。</p>

<pre><code class="language-shell"> make
Scanning dependencies of target FcitxQt5DBusAddons_automoc
[  4%] Automatic moc for target FcitxQt5DBusAddons
... ... 中间步骤省略
Linking CXX shared module libfcitxplatforminputcontextplugin.so
[100%] Built target fcitxplatforminputcontextplugin
</code></pre>

<p>进入构建目录下的<code>platforminputcontext</code>目录，即可看到生成的<code>libfcitxplatforminputcontextplugin.so</code>文件
将其拷贝到QtCreator安装目录下的<code>..../QtCreator/bin/plugins/platforminputcontexts</code>目录下即可。</p>

<p><strong>2016年08月17日更新</strong>
<code>QtCreator 4.0</code>的目录结构有一点小变化，需要将其拷贝到<code>QtCreator</code>目录下的<code>QtCreator/lib/Qt/plugins/platforminputcontexts</code>目录中。</p>

<pre><code class="language-shell">o@o-pc:~/fcitx/fcitx-qt5/build/platforminputcontext$ ls
CMakeFiles  cmake_install.cmake  fcitxplatforminputcontextplugin_automoc.cpp  libfcitxplatforminputcontextplugin.so  Makefile  moc_main.cpp  moc_qfcitxplatforminputcontext.cpp
</code></pre>

<pre><code class="language-bash">cp libfcitxplatforminputcontextplugin.so /home/o/program/qt_5.5/qt_5.5.1_x64/Tools/QtCreator/bin/plugins/platforminputcontexts/
</code></pre>

<p><img src="http://images.cnblogs.com/cnblogs_com/oloroso/704466/o_%e8%a7%a3%e5%86%b3QtCreator%203.5.1%e6%97%a0%e6%b3%95%e8%be%93%e5%85%a5%e4%b8%ad%e6%96%87%e7%9a%84%e9%97%ae%e9%a2%98.png" alt="输入中文示例" /></p>

        </div>
        <div class="sharing">







</div>
        



      </div>
    </div>

  </body>
  
</html>
